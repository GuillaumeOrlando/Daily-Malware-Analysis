ReZer0v4

Anti-VM capabilities:
	Search for virtualization brand artifacts from the graphic driver:
		WMI query: "SELECT * FROM Win32_VideoController"
		Search for the strings: "QEMU", "VirtualBox Graphics Adapter", "VMware SVGA II", "VM Additions S3 Trio32/64", "S3 Trio32/64"

	Search for the WINE function artefact in kernell32.dll: "wine_get_unix_file_name"

	Search for HardDrive name related to a virtualization brand under the registry keys:
		"HARDWARE\DEVICEMAP\Scsi\Scsi Port 2\Scsi Bus 0\Target Id 0\Logical Unit Id 0"
		"HARDWARE\DEVICEMAP\Scsi\Scsi Port 1\Scsi Bus 0\Target Id 0\Logical Unit Id 0"
		"HARDWARE\DEVICEMAP\Scsi\Scsi Port 0\Scsi Bus 0\Target Id 0\Logical Unit Id 0"

	Search a Graphic adapter related to virtualization brands under the registry key:
		"SYSTEM\ControlSet001\Control\Class\{4D36E968-E325-11CE-BFC1-08002BE10318}\0000\Settings"

	Search for vmware-tools folder under: "C:\PROGRAM FILES\VMWARE\VMWARE TOOLS\"

	Search for the following registry keys: "HKLM\HARDWARE\Description\System" and check if it contain the value: "VBOX", "VMWARE" or "VIRTUALBOX"

	Search for the following registry keys: "HKLM\SOFTWARE\Oracle\VirtualBox Guest Additions", "SOFTWARE\VMware, Inc.\VMware Tools"

Anti-Sandbox:
	Search for an username that contain: "VIRUS", "MALWARE", "SCHMIDTI", "CURRENTUSER" or "USER"

	Search for a Sandboxies dll: "SbieDll.dll"

	Search if it own file name contain: "SAMPLE", "VIRUS", "MALWARE"

	Search if it is located at: "C:\file.exe"

Online ressource where the author have taken most of its anti-VM / Anti-Sandbox code (Confuser1337): https://github.com/ama6nen/Confuser1337/blob/master/Confuser1337/Resources/antivm.txt

String "hashing" technique used to hide a few strings.
Instrumentation of the "Class5.smethod_0()" function with dnSpy to retreive toses strings.
See "ReZe0V4_obfuscated_string_extract.txt" for a dull dump of the obfuscated strings used in this sample with their associated plaintext version.